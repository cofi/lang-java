definition

module org/sugarj/languages/SugarJ
imports org/sugarj/languages/Java 
        org/sugarj/languages/Sdf2
        org/sugarj/languages/Stratego
        org/sugarj/languages/EditorServices
        org/sugarj/languages/Sugar

exports
  lexical syntax
    [\ \t\12\r\n] -> LAYOUT

  context-free syntax %% ToplevelDeclaration
    JavaPackageDec -> ToplevelDeclaration
    JavaImportDec -> ToplevelDeclaration
    JavaTypeDec -> ToplevelDeclaration
    SugarDec -> ToplevelDeclaration

  context-free start-symbols
  	SugarCompilationUnit

  context-free syntax
    JavaPackageDec? JavaImportDec* (JavaTypeDec | SugarDec)* -> SugarCompilationUnit {cons("CompilationUnit")}

  context-free syntax
    SugarDecHead SugarBody                 -> SugarDec {cons("SugarDec")}

    AnnoOrSugarMod* "sugar" JavaId            -> SugarDecHead       {cons("SugarDecHead")}
    JavaAnno                                  -> AnnoOrSugarMod     
    SugarMod                                  -> AnnoOrSugarMod     
    JavaPublic                                -> SugarMod           

    "{" SugarDefElem* "}"    -> SugarBody       {cons("SugarBody")}

  lexical restrictions
    "sugar" -/- [a-zA-Z0-9\'\-\_]

  context-free syntax
    EditorServicesDecHead EditorServicesBody   -> SugarDec              {cons("EditorServicesDec")}
    AnnoOrSugarMod* "editor" "services" JavaId -> EditorServicesDecHead {cons("EditorServicesDecHead")}
    "{" EditorServiceSection* "}"              -> EditorServicesBody    {cons("EditorServicesBody")}

  context-free syntax
    ChecksDecHead ChecksBody   -> ToplevelDeclaration              {cons("ChecksDec")}
    AnnoOrSugarMod* "analysis" JavaId -> ChecksDecHead {cons("ChecksDecHead")}
    AnnoOrSugarMod* "checks" JavaId -> ChecksDecHead {cons("ChecksDecHead")}
    "{" CheckingRule* "}"              -> ChecksBody    {cons("ChecksBody")}

    "errors" CheckingRuleBody*                          -> CheckingRule     {cons("CheckingRuleErrors")}
    "warnings" CheckingRuleBody*                        -> CheckingRule     {cons("CheckingRuleWarnings")}
    "notes" CheckingRuleBody*                           -> CheckingRule     {cons("CheckingRuleNotes")}
    StrategoTerm "=" StrategoTerm                          -> CheckingRuleBody {cons("RuleNoCond")}
    StrategoTerm "=" StrategoTerm "where" StrategoStrategy -> CheckingRuleBody {cons("Rule")}
    StrategoTerm "=" StrategoTerm StrategoRuleCond+        -> CheckingRuleBody {cons("Rule"), avoid}
    "rules" StrategoDef*        -> CheckingRule {cons("Rules")}

  lexical syntax
         -> "}" {recover, reject}

